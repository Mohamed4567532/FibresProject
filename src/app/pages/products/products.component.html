<!-- Hero Section -->
<section class="page-hero">
  <div class="container">
    <div class="hero-content">
      <h1>Nos Produits</h1>
      <p>Découvrez notre gamme complète de produits fibre optique</p>
    </div>
  </div>
</section>

<!-- Filters and Search -->
<section class="filters-section">
  <div class="container">
    <div class="filters-content">
      <div class="search-bar">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Rechercher un produit</mat-label>
          <input matInput [(ngModel)]="searchTerm" (input)="filterProducts()" placeholder="Nom, description, catégorie...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
      
      <div class="filters">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Catégorie</mat-label>
          <mat-select [(ngModel)]="selectedCategory" (selectionChange)="filterProducts()">
            <mat-option value="">Toutes les catégories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category">{{ category }}</mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Trier par</mat-label>
          <mat-select [(ngModel)]="sortBy" (selectionChange)="sortProducts()">
            <mat-option value="name">Nom</mat-option>
            <mat-option value="price-asc">Prix croissant</mat-option>
            <mat-option value="price-desc">Prix décroissant</mat-option>
            <mat-option value="rating">Note</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </div>
</section>

<!-- Products Grid -->
<section class="products-section section">
  <div class="container">
    <div class="products-header">
      <h2>{{ filteredProducts.length }} produits trouvés</h2>
      <div class="view-toggle">
        <button mat-icon-button [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')">
          <mat-icon>grid_view</mat-icon>
        </button>
        <button mat-icon-button [class.active]="viewMode === 'list'" (click)="setViewMode('list')">
          <mat-icon>list</mat-icon>
        </button>
      </div>
      <button mat-raised-button class="btn-primary" (click)="openAddProductDialog()" *ngIf="isAdmin">
        <mat-icon>add</mat-icon>
        Ajouter un produit
      </button>
      
      <!-- Message informatif pour les non-administrateurs -->
      <div class="admin-info" *ngIf="isAuthenticated && !isAdmin">
        <mat-icon>info</mat-icon>
        <span>Seuls les administrateurs peuvent ajouter des produits</span>
      </div>
    </div>
    
    <div class="products-grid" [class.list-view]="viewMode === 'list'">
      <div class="product-card card" *ngFor="let product of filteredProducts">
        <div class="product-image">
          <img [src]="product.image" [alt]="product.name" class="product-img">
          <div class="product-badge" *ngIf="product.rating >= 4.5">Top</div>
          <div class="stock-badge" [class.out-of-stock]="!product.inStock">
            {{ product.inStock ? 'En stock' : 'Rupture' }}
          </div>
        </div>
        <div class="product-content">
          <div class="product-header">
            <h3>{{ product.name }}</h3>
            <span class="product-category">{{ product.category }}</span>
          </div>
          <p class="product-description">{{ product.description }}</p>
          
          <div class="product-specs">
            <div class="spec-item">
              <mat-icon>speed</mat-icon>
              <span>{{ product.specifications.speed }}</span>
            </div>
            <div class="spec-item">
              <mat-icon>straighten</mat-icon>
              <span>{{ product.specifications.distance }}</span>
            </div>
            <div class="spec-item">
              <mat-icon>wavelength</mat-icon>
              <span>{{ product.specifications.wavelength }}</span>
            </div>
          </div>
          
          <div class="product-features">
            <span *ngFor="let feature of product.features" class="feature-tag">{{ feature }}</span>
          </div>
          
          <div class="product-footer">
            <div class="product-price">
              <span class="price">{{ product.price }} DT</span>
              <span class="unit" *ngIf="product.category === 'Câbles'">/mètre</span>
              <span class="unit" *ngIf="product.category !== 'Câbles'">/unité</span>
            </div>
            <div class="product-rating">
              <div class="stars">
                <mat-icon *ngFor="let star of [1,2,3,4,5]">star</mat-icon>
              </div>
              <span class="rating-text">{{ product.rating }}/5 ({{ product.reviews }} avis)</span>
            </div>
          </div>
          
          <div class="product-actions">
            <div class="quantity-selector" *ngIf="product.inStock">
              <button mat-icon-button (click)="decreaseQuantity(product.id)" [disabled]="getProductQuantity(product.id) === 0">
                <mat-icon>remove</mat-icon>
              </button>
              <span class="quantity">{{ getProductQuantity(product.id) }}</span>
              <button mat-icon-button (click)="increaseQuantity(product.id)">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            
            <button mat-raised-button 
                    class="btn-primary add-to-cart-btn" 
                    [disabled]="!product.inStock"
                    (click)="addToCart(product)">
              <mat-icon>shopping_cart</mat-icon>
              {{ isInCart(product.id) ? 'Ajouté' : 'Ajouter au panier' }}
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="no-products" *ngIf="filteredProducts.length === 0">
      <mat-icon>search_off</mat-icon>
      <h3>Aucun produit trouvé</h3>
      <p>Essayez de modifier vos critères de recherche</p>
    </div>
  </div>
</section>

<!-- Cart Summary -->
<section class="cart-summary" *ngIf="cartItemCount > 0">
  <div class="container">
    <div class="cart-content">
      <div class="cart-info">
        <mat-icon>shopping_cart</mat-icon>
        <span>{{ cartItemCount }} article(s) dans le panier</span>
        <span class="cart-total">Total: {{ cartTotal }} DT</span>
      </div>
      <div class="cart-actions">
        <button mat-button class="btn-secondary" (click)="viewCart()">Voir le panier</button>
        <button mat-raised-button class="btn-primary" (click)="checkout()">Commander</button>
      </div>
    </div>
  </div>
</section>
